var hot,hotter,hottest,hooks;var currentInterval;var user;var columnHeaders;function checkPrivilege(){user=sessionStorage.getItem("currentUser");if(user==undefined){alert("Please log into your account.");window.open("Login.html","_self",!1)}
loadParticipants(user)}
function loadParticipants(username){var requestURL="http://localhost:8888/PsychPHP/AdminDetails.php";httpRequest=new XMLHttpRequest()
httpRequest.onreadystatechange=loadCurrentParticipants;httpRequest.open('POST',requestURL);httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');httpRequest.send('userName='+encodeURIComponent(username)+"&action="+encodeURIComponent("requestParticipants"))}
function loadLastState(){var requestURL="http://localhost:8888/PsychPHP/AdminDetails.php";httpRequest=new XMLHttpRequest()
httpRequest.onreadystatechange=loadRestrictionsTable;httpRequest.open('POST',requestURL);httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');httpRequest.send('userName='+encodeURIComponent("admin")+"&action="+encodeURIComponent("requestRestrictions"))}
function loadLoginInfo(){var requestURL="http://localhost:8888/PsychPHP/AdminDetails.php";httpRequest=new XMLHttpRequest()
httpRequest.onreadystatechange=loadLoginTable;httpRequest.open('POST',requestURL);httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');httpRequest.send('userName='+encodeURIComponent("admin")+"&action="+encodeURIComponent("requestLogin"))}
function loadRestrictionsTable(){try{if(httpRequest.readyState===XMLHttpRequest.DONE){if(httpRequest.status===200){var response=httpRequest.responseText;response=JSON.parse(response);loadSecondGrid(response);registerHooks();loadLoginInfo()}else{alert('There was a problem with request.')}}
return 1}catch(e)
{alert('Caught Exception: loadRestrictionsTable'+e.description)}}
function loadLoginTable(){try{if(httpRequest.readyState===XMLHttpRequest.DONE){if(httpRequest.status===200){var response=httpRequest.responseText;response=JSON.parse(response);loadThirdGrid(response);registerSecondHooks()}else{alert('There was a problem login load request.')}}
return 1}catch(e)
{alert('Caught Exception: loadLoginTable -'+e.description)}}
function loadCurrentParticipants(){try{if(httpRequest.readyState===XMLHttpRequest.DONE){if(httpRequest.status===200){var response=httpRequest.responseText;if(response=="empty"){alert("No participants")}else{response=JSON.parse(response);document.getElementById("participantsList").innerHTML="";document.getElementById("participantsContainer").style.display="block";for(i=0;i<response.length;i++){obj=response[i];insertParticipant(obj.username,obj.tasknum)}}
loadLastState();return}else{alert('There was a problem with the request.')}}
return 1}catch(e)
{alert('Caught Exception: loadCurrentParticipants '+e.description)}}
function insertParticipant(username,tasknum){unorderedlist=document.getElementById("participantsList");listItem="<li><button onclick=\"getTaskNum('"+username+"',"+tasknum+")\">"+username+"</button></li>";temp=unorderedlist.innerHTML;unorderedlist.innerHTML=temp+listItem}
function getTaskNum(username,tasknum){currentInterval=clearInterval(currentInterval);user=username;requestTask(username);if(document.getElementById("autoRefreshCheckBox").checked==!0){autoRefresh();currentInterval=setInterval(requestTask,3000,username)}}
function requestTask(username){var requestURL="http://localhost:8888/PsychPHP/AdminDetails.php";httpRequest=new XMLHttpRequest()
httpRequest.onreadystatechange=loadCurrentTask;httpRequest.open('POST',requestURL);httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');httpRequest.send('userName='+encodeURIComponent(username)+"&action="+encodeURIComponent("requestTask"))}
function loadCurrentTask(){try{if(httpRequest.readyState===XMLHttpRequest.DONE){if(httpRequest.status===200){var response=httpRequest.responseText;if(response=="No Task"){return}
viewLiveFeed(user,response)}else{alert('There was a problem with the request.')}}
return 1}catch(e)
{alert('Caught Exception: loadCurrentTask'+e.description)}}
function viewLiveFeed(username,tasknum){if(tasknum==1){document.getElementById("mainContainer").innerHTML="<div id='gridContainer' ></div>";loadFinancialInfoTable(username)}
if(tasknum==2){document.getElementById("mainContainer").innerHTML="<textarea id = 'memoTextArea'></textarea></div>";loadMemo(username)}
if(tasknum==3){document.getElementById("mainContainer").innerHTML="<div id='gridContainer' ></div>";loadCrossCheckInfoTable(username)}
if(tasknum==4){document.getElementById("mainContainer").innerHTML="<div id='gridContainer' ></div>";loadSortedFiles(username)}
if(tasknum==5){document.getElementById("mainContainer").innerHTML="<div id='gridContainer' ></div>";loadPercentages(username)}
if(tasknum==6){document.getElementById("mainContainer").innerHTML="<div id='gridContainer' ></div>";loadLabelingApointments(username)}}
function loadFinancialInfoTable(username){document.getElementById("mainContainer").innerHTML="<div id='gridContainer' ></div>";var requestURL="http://localhost:8888/PsychPHP/AdminDetails.php";httpRequest=new XMLHttpRequest();httpRequest.onreadystatechange=loadTable;httpRequest.open('POST',requestURL);httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');httpRequest.send('userName='+encodeURIComponent(username)+'&action='+encodeURIComponent('financial'))}
function loadSortedFiles(username){document.getElementById("mainContainer").innerHTML="<div id='gridContainer'></div>";var requestURL="http://localhost:8888/PsychPHP/AdminDetails.php";httpRequest=new XMLHttpRequest();httpRequest.onreadystatechange=loadTable;httpRequest.open('POST',requestURL);httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');httpRequest.send('userName='+encodeURIComponent(username)+'&action='+encodeURIComponent('files'))}
function loadMemo(username){document.getElementById("mainContainer").innerHTML="<textarea id = 'memoTextArea'></textarea></div>";var requestURL="http://localhost:8888/PsychPHP/AdminDetails.php";httpRequest=new XMLHttpRequest();httpRequest.onreadystatechange=loadMemoText;httpRequest.open('POST',requestURL);httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');httpRequest.send('userName='+encodeURIComponent(username)+'&action='+encodeURIComponent('memo'))}
function loadMemoText(){try{if(httpRequest.readyState===XMLHttpRequest.DONE){if(httpRequest.status===200){var response=httpRequest.responseText;document.getElementById("memoTextArea").innerHTML=response}else{alert('There was a problem with request.')}}
return 1}catch(e)
{alert('Caught Exception: loadMemoText'+e.description)}}
function loadLabelingApointments(username){document.getElementById("mainContainer").innerHTML="<div id='gridContainer' ></div>";var requestURL="http://localhost:8888/PsychPHP/AdminDetails.php";httpRequest=new XMLHttpRequest();httpRequest.onreadystatechange=loadTable;httpRequest.open('POST',requestURL);httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');httpRequest.send('userName='+encodeURIComponent(username)+'&action='+encodeURIComponent('labelAppointment'))}
function loadCrossCheckInfoTable(username){document.getElementById("mainContainer").innerHTML="<div id='gridContainer' ></div>";var requestURL="http://localhost:8888/PsychPHP/AdminDetails.php";httpRequest=new XMLHttpRequest();httpRequest.onreadystatechange=loadTable;httpRequest.open('POST',requestURL);httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');httpRequest.send('userName='+encodeURIComponent(username)+'&action='+encodeURIComponent('crossCheck'))}
function loadPercentages(username){document.getElementById("mainContainer").innerHTML="<div id='gridContainer' ></div>";var requestURL="http://localhost:8888/PsychPHP/AdminDetails.php";httpRequest=new XMLHttpRequest();httpRequest.onreadystatechange=loadTable;httpRequest.open('POST',requestURL);httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');httpRequest.send('userName='+encodeURIComponent(username)+'&action='+encodeURIComponent('percentage'))}
function pes(){}
function loadTable(){try{if(httpRequest.readyState===XMLHttpRequest.DONE){if(httpRequest.status===200){var response=httpRequest.responseText;response=JSON.parse(response);loadGrid(response)}else{alert('There was a problem with request.')}}
return 1}catch(e)
{alert('Caught Exception: loadTable -'+e.description)}}
function loadGrid(response){var data=response;var container=document.getElementById('gridContainer');hot=new Handsontable(container,{data:data,rowHeaders:!0,minCols:0,minRows:0,minSpareRows:2,columnSorting:!0,readOnly:!0,contextMenu:!0,fillHandle:{autoInsertRow:!1,}})}
function loadSecondGrid(response){var data=response;var container=document.getElementById('gridContainer2');hotter=new Handsontable(container,{data:data,rowHeaders:!0,minCols:0,minRows:0,startCols:4,minSpareRows:2,columnSorting:!1,colHeaders:['Username','Limiter','Limited','Day'],contextMenu:!0,fillHandle:{autoInsertRow:!1,},})}
function loadThirdGrid(response){var data=response;var container=document.getElementById('gridContainer3');hottest=new Handsontable(container,{data:data,rowHeaders:!0,minCols:0,minRows:0,startCols:9,minSpareRows:2,columnSorting:!1,colHeaders:['Username','Password','Email Address','Financial','Memo','X-Check','Sort Files','Percentages','Appointments'],contextMenu:!0,fillHandle:{autoInsertRow:!1,},})}
function showParticipants(){var x=document.getElementById("participantsContainer");var y=document.getElementById("particpantsCheckBox");if(y.checked==!0){x.style.display="block"}else{x.style.display="none"}}
function showLiveFeed(){var x=document.getElementById("mainContainer");var y=document.getElementById("liveFeedCheckBox");if(y.checked==!0){x.style.display="block"}else{x.style.display="none"}}
function registerHooks(){Handsontable.hooks.add('afterChange',function(change,source){saveChanges()},hotter)}
function registerSecondHooks(){Handsontable.hooks.add('afterChange',function(change,source){saveLoginChanges()},hottest)}
function saveChanges(){var infoArray=[];for(let i=0;i<=hotter.countRows();i++){temp=new Object();temp.recordUsername=hotter.getDataAtCell(i,0);temp.recordLimiter=hotter.getDataAtCell(i,1);temp.recordLimited=hotter.getDataAtCell(i,2);temp.recordDay=hotter.getDataAtCell(i,3);infoArray.push(JSON.stringify(temp))}
var requestURL="http://localhost:8888/PsychPHP/AdminDetails.php";httpRequest=new XMLHttpRequest();httpRequest.open('POST',requestURL);httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');httpRequest.send('userName='+encodeURIComponent("admin")+"&action="+encodeURIComponent("saveRestriction")+'&info='+JSON.stringify(infoArray))}
function saveLoginChanges(){var infoArray=[];for(let i=0;i<=hottest.countRows();i++){temp=new Object();temp.recordUsername=hottest.getDataAtCell(i,0);temp.recordPassword=hottest.getDataAtCell(i,1);temp.recordEmail=hottest.getDataAtCell(i,2);temp.recordAdmin=0;temp.recordFinancial=hottest.getDataAtCell(i,3);temp.recordMemo=hottest.getDataAtCell(i,4);temp.recordCrossCheck=hottest.getDataAtCell(i,5);temp.recordSortFiles=hottest.getDataAtCell(i,6);temp.recordPercentage=hottest.getDataAtCell(i,7);temp.recordAppointments=hottest.getDataAtCell(i,8);infoArray.push(JSON.stringify(temp))}
var requestURL="http://localhost:8888/PsychPHP/AdminDetails.php";httpRequest=new XMLHttpRequest();httpRequest.open('POST',requestURL);httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');httpRequest.send('userName='+encodeURIComponent("admin")+"&action="+encodeURIComponent("saveLogin")+'&info='+JSON.stringify(infoArray))}
function testFunc(){try{if(httpRequest.readyState===XMLHttpRequest.DONE){if(httpRequest.status===200){var response=httpRequest.responseText;alert(response)}else{alert('There was a problem with request.')}}
return 1}catch(e)
{alert('Caught Exception: testFunc -'+e.description)}}
function autoRefresh(){var y=document.getElementById("autoRefreshCheckBox");var icon=document.getElementById("refreshing");if(y.checked==!1){icon.classList.remove("shown");icon.classList.add("hidden");currentInterval=clearInterval(currentInterval)}else{icon.classList.add("shown");icon.classList.remove("hidden");requestTask(user);currentInterval=setInterval(requestTask,3000,user)}}
function showRestrictions(){var x=document.getElementById("mainContainer2");var y=document.getElementById("restrictionsCheckBox");if(y.checked==!0){x.style.display="block"}else{x.style.display="none"}}
function showLogin(){var x=document.getElementById("mainContainer3");var y=document.getElementById("loginCheckBox");if(y.checked==!0){x.style.display="block"}else{x.style.display="none"}}
